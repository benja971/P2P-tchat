\chapter{Comment mettre en place une connexion pair à pair}

\section{Avec WebRTC}

L'utilisation de WebRTC est l'une des solutions possibles pour mettre en place une communication textuelle en temps réel entre deux clients dans un réseau pair à pair.
Pour établir cette connexion, les étapes suivantes peuvent être suivies :

\paragraph{Initialisation d'une pair et récupération de son ID}

Chaque client doit être initialisé en tant que pair et se voit attribuer un ID unique. Cet ID est utilisé pour l'identifier et permettre à d'autres de s'y'connecter.

\paragraph{Partage des ID entre les deux pairs}

Une fois que chaque noeuds a obtenu son ID, ces identifiants doivent être partagés entre les deux clients afin qu'ils puissent s'identifier mutuellement lors de l'établissement de la connexion. 
Cela peut être réalisé par l'intermédiaire d'un serveur de signalisation ou d'un canal de communication préalablement établi, tel qu'un serveur centralisé ou un autre moyen de communication sécurisé.

\paragraph{Création d'une connexion entre les deux pairs}

Une fois que chaque pair dispose de l'ID de l'autre, ils peuvent utiliser ce dernier pour établir une connexion directe entre eux en utilisant le protocole WebRTC. Ce dernier permet aux clients d'établir des connexions directes,
contournant ainsi les NAT et réduisant la latence. Le tou grace à l'utilisation de protocoles de traversée NAT (NAT traversal protocol) ou les techniques de trous de poinçonnage (hole punching) pour contourner les limitations des NAT.


\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\textwidth]{assets/webrtc.png}
    \caption{Schéma de connection avec WebRTC}
    \label{fig:webrtc}
\end{figure}

\newpage

\section{Avec WebSockets}

Une autre solution pour mettre en place une communication textuelle en temps réel entre deux clients serait d'utiliser les WebSockets.
La principale difference avec WebRTC, c'est que les Sockets nécessitent la connaissance des adresses IP des deux noeuds pour pouvoir établir une connexion entre eux.
Pour établir cette connexion, les étapes suivantes peuvent être suivies :

\newpage

\paragraph{Récupération de l'adresse IP publique du client}

Pour pouvoir établir une connexion entre deux clients, il faut que chaque client connaisse l'adresse IP publique ainsi que le port utilisé par l'autre. Mais avant cela, ils doivent donc récupérer leurs adresses IP publique afin
de les partager. Pour cela, il existe une solution (non unique) qui consiste à utiliser un service STUN qui permet de récupérer l'adresse IP publique du client ainsi qu'un port ouvert sur le pare-feu du client.

\paragraph{Partager son adresse IP publique et le port ouvert sur le pare-feu avec l'autre pair}

Une fois ces informations récupérées, chaque pair doit partager son adresse IP publique ainsi que le port ouvert sur son pare-feu avec l'autre. Cela peut être réalisé par l'intermédiaire d'un serveur de signalisation 
ou d'un canal de communication préalablement établi, tel qu'un serveur centralisé ou un autre moyen de communication sécurisé.

\paragraph{Création d'une connexion entre les deux pairs}

Une fois que chaque pair dispose de l'adresse IP publique et du port ouvert sur le pare-feu de l'autre pair, ils peuvent utiliser ces informations pour établir une connexion directe entre eux. 


\newpage
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.99\textwidth]{assets/socket.png}
    \caption{Schéma de connection avec WebSockets}
    \label{fig:websockets}
\end{figure}


\vspace{4cm}

\section{Les outils tiers nécessaires pour la communication pair à pair}
\subsection{Les serveurs de signalisation}

\paragraph{}
Pour établir une communication entre deux clients, il est souvent nécessaire de mettre en place des serveurs de signalisation. Les serveurs de signalisation agissent comme des intermédiaires pour faciliter 
l'établissement de la connexion initiale.

\paragraph{}
Lorsqu'un client souhaite établir une communication avec un autre client, il doit d'abord échanger des informations telles que les adresses IP et les ports. Les serveurs de signalisation permettent aux clients de partager ces 
informations entre eux. Ils peuvent également aider à coordonner les étapes de négociation et d'établissement de la connexion.

\paragraph{}
Les serveurs de signalisation peuvent utiliser différents protocoles et techniques pour échanger les informations nécessaires. Par exemple, ils peuvent utiliser des protocoles basés sur le web tels que HTTP pour envoyer des messages 
de signalisation entre les clients. Ils peuvent également utiliser des protocoles de signalisation spécialisés tels que SIP (Session Initiation Protocol) ou XMPP (Extensible Messaging and Presence Protocol).

\paragraph{}
Il existe différentes options pour mettre en place des serveurs de signalisation, allant des solutions prêtes à l'emploi aux serveurs personnalisés développés en interne. Certains services cloud offrent également des 
fonctionnalités de signalisation pour faciliter l'établissement de connexions pair à pair.

\paragraph{}
Il est important de noter que les serveurs de signalisation ne sont généralement pas impliqués dans le transfert direct des données entre les clients. Ils jouent simplement un rôle de coordination pour permettre 
l'établissement de la connexion initiale.

\newpage
\subsection{Les protocoles TURN et STUN}

Pour faciliter les communications pair à pair, il est souvent nécessaire de prendre en compte les contraintes de réseau telles que les pare-feu et les NAT (Network Address Translation). Deux protocoles couramment utilisés pour résoudre ces 
problèmes sont TURN (Traversal Using Relays around NAT) et STUN (Session Traversal Utilities for NAT).

\paragraph{}
Le protocole STUN permet à un client d'obtenir des informations sur son adresse IP publique et le type de NAT qu'il traverse. Cela permet au client de comprendre comment il est connecté au réseau et d'adapter ses stratégies de 
connexion en conséquence. STUN est généralement utilisé pour faciliter l'établissement de connexions pair à pair lorsque les clients sont derrière des NAT symétriques ou des pare-feu restrictifs.

\paragraph{}
Le protocole TURN est utilisé lorsque les connexions directes ne sont pas possibles en raison de pare-feu ou de NAT restrictifs. TURN utilise un serveur intermédiaire (relais) auquel les clients se connectent pour acheminer 
leurs données. Ce serveur intermédiaire agit comme un proxy et transfère les données entre les clients. Cela permet aux clients de communiquer même s'ils ne peuvent pas établir une connexion directe.

\paragraph{}
Lorsqu'un client rencontre des difficultés pour établir une connexion directe en raison des restrictions du réseau, il peut utiliser STUN pour obtenir son adresse IP publique, puis essayer d'établir une connexion directe. 
Si cela échoue, le client peut passer à l'utilisation de TURN pour acheminer les données via un serveur relais.

\paragraph{}
Il est important de noter que l'utilisation de TURN peut entraîner une latence supplémentaire car les données doivent être acheminées via le serveur relais. De plus, l'utilisation d'un serveur relais peut entraîner des coûts supplémentaires, 
notamment si vous utilisez un service cloud ou un fournisseur tiers pour héberger le serveur.

\paragraph{}
En résumé, les protocoles TURN et STUN sont des outils importants pour faciliter les communications lorsque les clients sont derrière des NAT restrictifs ou des pare-feu. Ils permettent de contourner les contraintes réseau et de 
faciliter l'établissement de connexions directes ou le transfert des données via un serveur relais lorsque cela est nécessaire.
